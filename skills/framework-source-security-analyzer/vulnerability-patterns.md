# 프레임워크별 핵심 취약점 패턴 카탈로그

이 문서는 주요 프레임워크와 언어에서 반복적으로 발견되는 메타 보안 패턴을 정리한 참고 자료다.
실제 분석 시 이 패턴들을 염두에 두고 소스코드를 조사한다.

---

## Spring Framework (Java)

### Mass Assignment via DataBinder
**위치**: `spring-webmvc/src/main/java/org/springframework/web/bind/WebDataBinder.java`

**패턴**:
- `@ModelAttribute`로 자동 바인딩
- Request parameter가 자동으로 객체 필드에 매핑
- 개발자가 의도하지 않은 필드(예: `isAdmin`) 수정 가능

**관련 CVE**: CVE-2022-22965 (Spring4Shell)

**소스 분석 포인트**:
```java
// WebDataBinder.java
protected void doBind(MutablePropertyValues mpvs) {
    checkAllowedFields(mpvs);  // allowedFields 체크
    checkRequiredFields(mpvs);
    applyPropertyValues(mpvs); // 실제 바인딩
}
```

**완화**:
- `@InitBinder`로 allowedFields 화이트리스트 설정
- DTO 분리 (RequestDTO vs Entity)

---

### SpEL Injection
**위치**: `spring-expression` 모듈

**패턴**:
- Spring Expression Language가 사용자 입력 평가
- `@Value`, `@PreAuthorize` 등에서 동적 표현식 사용
- RCE 가능

**관련 CVE**: CVE-2022-22950

**소스 분석 포인트**:
```java
// SpelExpressionParser.java
Expression exp = parser.parseExpression(userInput); // 위험
Object value = exp.getValue();
```

---

### Spring Boot Actuator Exposure
**위치**: `spring-boot-actuator`

**패턴**:
- Actuator endpoints 기본 활성화 (버전별 다름)
- `/actuator/env`, `/actuator/heapdump` 등 민감 정보 노출
- 인증 없이 접근 가능한 경우 많음

**소스 분석 포인트**:
```yaml
# application.yml defaults
management:
  endpoints:
    web:
      exposure:
        include: "*"  # 위험한 기본값
```

---

## Django (Python)

### Mass Assignment via ModelForm
**위치**: `django/forms/models.py`

**패턴**:
- `ModelForm`이 모든 model 필드 자동 생성
- `exclude` 대신 `fields`를 명시하지 않으면 취약

**소스 분석 포인트**:
```python
# forms/models.py
class ModelForm(BaseModelForm):
    def __init__(self, ...):
        if self.Meta.fields is None:  # fields 미지정
            # 모든 필드 자동 포함 - 위험!
            pass
```

**완화**:
- `fields = ['name', 'email']` 명시적 화이트리스트
- `exclude` 대신 `fields` 사용

---

### Template Injection
**위치**: Django Template Language (DTL)

**패턴**:
- 사용자가 템플릿 문자열 제어 시 RCE
- `Template(user_input).render(context)`
- Auto-escaping이 코드 실행은 막지 못함

**소스 분석 포인트**:
```python
# django/template/base.py
class Template:
    def __init__(self, template_string, ...):
        self.nodelist = self.compile_nodelist()  # 파싱 시 실행
```

---

### ORM SQL Injection
**위치**: `django/db/models/query.py`

**패턴**:
- `extra()`, `raw()` 사용 시 주입 가능
- F-strings로 쿼리 구성 시 취약

**소스 분석 포인트**:
```python
# 위험한 패턴
User.objects.extra(where=[f"name = '{user_input}'"])
```

---

## Express.js (Node.js)

### Prototype Pollution
**위치**: `body-parser`, 내장 JSON 파싱

**패턴**:
- JSON에서 `__proto__` 키 파싱
- Object.prototype 오염
- 전역 상태 변경으로 인한 보안 우회

**관련 CVE**: CVE-2022-24999 (qs library)

**소스 분석 포인트**:
```javascript
// body-parser/lib/types/json.js
function parse(body) {
    return JSON.parse(body);  // __proto__ 처리 안함
}
```

**완화**:
- `Object.create(null)` 사용
- JSON Schema validation

---

### Path Traversal in Static Files
**위치**: `express.static` middleware

**패턴**:
- `../` 처리 불완전
- URL encoding 우회
- 의도하지 않은 파일 접근

**소스 분석 포인트**:
```javascript
// express/lib/middleware/static.js
path = decodeURIComponent(path);  // 디코딩 순서 중요
```

---

## ASP.NET Core (C#)

### Mass Assignment via Model Binding
**위치**: `Microsoft.AspNetCore.Mvc.ModelBinding`

**패턴**:
- Spring과 유사한 자동 바인딩
- `[Bind]` attribute 미사용 시 취약

**소스 분석 포인트**:
```csharp
// ModelBindingContext.cs
public void SetModelValue(string key, object value) {
    // 자동 property 설정
}
```

---

### XML External Entity (XXE)
**위치**: `System.Xml`

**패턴**:
- XmlReader 기본 설정이 DTD 허용
- External entity 로드 가능

**소스 분석 포인트**:
```csharp
// 위험한 기본 설정
var settings = new XmlReaderSettings();
// DtdProcessing.Prohibit 명시 필요
```

---

## Java Standard Library

### URL Parsing Confusion
**위치**: `java.net.URL`

**패턴**:
- `getHost()` vs `getAuthority()` 차이
- `http://expected.com@attacker.com` 파싱 불일치
- SSRF, Open Redirect 유발

**소스 분석 포인트**:
```java
// java/net/URL.java
public String getHost() {
    return host;  // userInfo 제외한 호스트
}

public String getAuthority() {
    return authority;  // userInfo 포함
}
```

**완화**:
- `URI` 클래스 사용
- `getHost()` 사용 후 userInfo 검증

---

### Deserialization RCE
**위치**: `java.io.ObjectInputStream`

**패턴**:
- `readObject()` 시 임의 클래스 인스턴스화
- Gadget chains 통해 RCE
- 신뢰할 수 없는 데이터 역직렬화 시 취약

**관련 CVE**: 수백 개의 Java deserialization CVE

**소스 분석 포인트**:
```java
// java/io/ObjectInputStream.java
private Object readObject0(boolean unshared) {
    // 클래스 타입 체크 없이 인스턴스화
    Object obj = desc.newInstance();
    // readObject() 메소드 자동 호출 (gadget)
}
```

**완화**:
- `ValidatingObjectInputStream` 사용
- 화이트리스트 기반 클래스 필터
- JSON 등 대체 포맷 사용

---

### XXE in XML Parsers
**위치**: `javax.xml.parsers`

**패턴**:
- DocumentBuilderFactory 기본 설정 불안전
- External entity 로드 허용
- 파일 읽기, SSRF 가능

**소스 분석 포인트**:
```java
// 위험한 기본 설정
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
// setFeature로 XXE 방지 필요
```

---

## Python Standard Library

### Pickle Deserialization
**위치**: `pickle` 모듈

**패턴**:
- `pickle.loads()` 시 임의 코드 실행
- `__reduce__` 메소드 악용
- RCE

**소스 분석 포인트**:
```python
# pickle.py
def load(file):
    # __reduce__ 메소드 호출
    # 임의 callable + args 실행 가능
```

**완화**:
- 신뢰할 수 없는 데이터에 pickle 사용 금지
- JSON, msgpack 등 대체

---

### eval/exec Injection
**위치**: 내장 함수

**패턴**:
- 사용자 입력 직접 평가
- Code injection

**소스 분석 포인트**:
```python
eval(user_input)  # 절대 사용 금지
exec(user_input)  # 절대 사용 금지
```

---

### Command Injection
**위치**: `os.system`, `subprocess`

**패턴**:
- Shell injection via string commands
- `shell=True` 사용 시 위험

**소스 분석 포인트**:
```python
# 위험
os.system(f"ls {user_input}")
subprocess.call(f"ping {user_input}", shell=True)

# 안전
subprocess.call(["ping", user_input])  # shell=False (기본값)
```

---

## Ruby on Rails

### Mass Assignment
**위치**: Active Record

**패턴**:
- Strong Parameters 미사용 시 취약
- `params.permit!` 사용 시 모든 필드 허용

**소스 분석 포인트**:
```ruby
# 위험
User.new(params[:user])  # 모든 attribute 허용

# 안전
User.new(user_params)
# private
def user_params
  params.require(:user).permit(:name, :email)
end
```

---

### SQL Injection via Unsafe Interpolation
**위치**: Active Record

**패턴**:
- String interpolation in `where` clause
- Raw SQL 사용

**소스 분석 포인트**:
```ruby
# 위험
User.where("name = '#{params[:name]}'")

# 안전
User.where("name = ?", params[:name])
User.where(name: params[:name])
```

---

## 언어별 공통 패턴

### Type Confusion
- 동적 타입 언어: 타입 검증 누락
- 정적 타입 언어: Reflection, Casting 오용

### Regex DoS (ReDoS)
- 복잡한 정규식 + 특수 입력 → 지수적 시간 복잡도
- 모든 언어 공통

### Integer Overflow/Underflow
- C/C++: 명확한 UB
- Java: Silent wrap-around
- Python 3: 자동 bigint (안전)

### Path Traversal
- 파일 경로 정규화 불일치
- OS별 경로 구분자 차이
- Symbolic link 처리

---

## 메타 패턴 분류

### 1. Framework Magic (프레임워크 자동화)
- Auto-binding
- Auto-escaping
- Convention over configuration

### 2. Backward Compatibility (하위 호환성)
- Insecure defaults maintained
- Deprecated features still available

### 3. Developer Convenience (개발자 편의)
- Debug mode defaults
- Verbose error messages
- Sample/default credentials

### 4. Abstraction Leaks (추상화 누수)
- ORM SQL generation
- Template expression evaluation
- Serialization format trust

### 5. Parser Differentials (파서 불일치)
- URL parsing
- HTTP header interpretation
- Content-Type sniffing

### 6. Implicit Capabilities (암묵적 기능)
- Magic methods
- Lifecycle hooks
- Dynamic property access

---

이 카탈로그는 분석 시작 시 참고용이다. 실제 분석에서는:
1. 이 패턴들을 염두에 두고 소스를 조사
2. 새로운 패턴 발견 시 기록
3. 프레임워크별 특수성 고려
